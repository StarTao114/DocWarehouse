C51 COMPILER V9.60.0.0   UART                                                              01/13/2024 20:02:51 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\OBJ\uart.obj
COMPILER INVOKED BY: D:\keil\KEIL_MDK\C51\BIN\C51.EXE APP\uart\uart.c LARGE ROM(COMPACT) OPTIMIZE(6,SIZE) BROWSE INCDIR(
                    -.\APP\base;.\APP\LoRa;.\APP\uart;.\APP\MidWare) DEBUG OBJECTEXTEND PRINT(.\uart.lst) OBJECT(.\OBJ\uart.obj)

line level    source

   1          #include "typedef.h"
   2          #include "gpio.h"
   3          #include "uart.h"
   4          #include "synchron.h"
   5          
   6          static bit bUartFlag;
   7          bit busy;
   8          
   9          u16 USART_RX_STA=0;       //接收状态标记  
  10          u8 USART_RX_BUF[USART_REC_LEN] = {0};
  11          
  12          //初始化串口
  13          void UartInit(void)
  14          {
  15   1              SCON = 0x50;    
  16   1              T2L = (65536 - MCU_FREQ /4 / UART_BUAD);
  17   1              T2H = (65536 - MCU_FREQ /4 / UART_BUAD) >> 8;
  18   1              AUXR = 0x14;
  19   1              AUXR |= 0x01;
  20   1              ES = 1;
  21   1              EA = 1;
  22   1              TI = 0;
  23   1      }
  24          
  25          
  26          void UART_SendData(unsigned char Byte)
  27          {
  28   1              u8 temp;
  29   1              while(busy);
  30   1      //      ACC = Byte;
  31   1              temp = Byte;
  32   1              TB8 = 0;
  33   1              
  34   1              busy = 1;
  35   1              SBUF = temp;
  36   1      }
  37          
  38          /******************************************************************************/
  39          // 函数名称uartSendString 
  40          // 输入参数:ps:字符串首地址
  41          // 输出参数:无
  42          // 串口功能:发送字符串通过串口输出
  43          /******************************************************************************/
  44          void uartSend(u8 *pS, u8 len)
  45          {
  46   1          UART_SendData(0xaa);
  47   1          while (len--)                     
  48   1          {
  49   2              UART_SendData(*pS++);
  50   2          }
  51   1              UART_SendData(0xbb);
  52   1      }
  53          
  54          
C51 COMPILER V9.60.0.0   UART                                                              01/13/2024 20:02:51 PAGE 2   

  55          void UART_Routine()    interrupt 4 using 1
  56          {
  57   1              u8 res = 0;
  58   1              if(TI)
  59   1              {
  60   2                      TI=0;                   //清除发送完成标志位
  61   2                      busy = 0;
  62   2              }
  63   1              if(RI)
  64   1              {
  65   2                      RI = 0;
  66   2                      
  67   2                      res = SBUF;
  68   2                      
  69   2                      if(USART_RX_STA&0x4000)                                         //若已经开始接收
  70   2                      {
  71   3                              
  72   3                              if(res == 0xbb)                                                 //若当前帧是结束帧
  73   3                              {
  74   4                                      USART_RX_STA |= 0x8000;                         //接收已完成
  75   4                                      USART_RX_BUF[USART_RX_STA&0X3FFF]='\0';
  76   4                                      synPeriod.byte[0] = USART_RX_BUF[0];
  77   4                                      synPeriod.byte[1] = USART_RX_BUF[1];
  78   4                              }
  79   3                              else
  80   3                              {
  81   4                                      USART_RX_BUF[USART_RX_STA&0X3FFF]=res ;
  82   4                                      USART_RX_STA++;
  83   4                              }
  84   3                      }
  85   2                      
  86   2                      if(res == 0xaa)                                                         //起始帧
  87   2                      {
  88   3                              USART_RX_STA = 0;
  89   3                              USART_RX_STA |= 0x4000;                                 //接收开始标志
  90   3                      }
  91   2                      
  92   2                      if((USART_RX_STA&0X3FFF) > USART_REC_LEN)
  93   2                      {
  94   3                              USART_RX_STA = 0;
  95   3                      }
  96   2                              
  97   2                      
  98   2              }
  99   1              
 100   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    253    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     22       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
